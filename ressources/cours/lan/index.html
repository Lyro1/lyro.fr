<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>LAN Concepts</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>


</head>

<body>

<h1 id="toc_0">LAN Concepts</h1>

<p>Mr <em>Khalil Debbaj</em></p>

<ul>
<li>Ingé Télécoms (ENSI)</li>
<li>Formateur CISCO - VMWARE (VSphere)</li>
<li>Inter Prool: Data Center</li>
<li>Techno Fabric Path</li>
<li>LAN-DC</li>
</ul>

<h3 id="toc_1">Remerciements</h3>

<ul>
<li>Vicky Chii</li>
</ul>

<h2 id="toc_2">Prérequis</h2>

<ul>
<li><a href="https://www.netacad.com/fr/courses/packet-tracer">Packet Tracer</a> (inscription au cours Cisco gratuit nécessaire pour activer le logiciel).</li>
</ul>

<p>Quelques astuces : </p>

<ul>
<li>Pour kill des commandes longues de type ping dans le terminal de Packet Tracerr, utilisez <code>control + ^</code> sur Mac.</li>
<li>Pour augmenter la taille de la police d&#39;écriture du terminal de Packet Tracer, rendez-vous dans <code>Preferences &gt; Font &gt; Dialogs &gt; CLI</code>. Il vous faudra ensuite fermer les consoles en cours et les relancer.</li>
</ul>

<h2 id="toc_3">Introduction</h2>

<p>La maitrise de certaines notions liées au réseau est essentielle dans le développement de certaines applications. Il peut être plus qu&#39;utile d&#39;être capable de mettre en place une configuration réseau en concordance avec les besoins des applications, que ce soit en terme de latence ou de bande passante.</p>

<h2 id="toc_4">Le protocole ARP</h2>

<p><em>Source: <a href="https://fr.wikipedia.org/wiki/Address_Resolution_Protocol">Wikipedia</a>.</em></p>

<p>Un ordinateur connecté à un réseau informatique souhaite émettre une trame ethernet à destination d’un autre ordinateur dont il connaît l’adresse IP et placé dans le même sous-réseau. Dans ce cas, cet ordinateur va placer son émission en attente et effectuer une requête ARP en broadcast de niveau 2. Cette requête est de type <em>« quelle est l’adresse MAC correspondant à l’adresse IP adresseIP ? Répondez à monAdresseIP »</em>.</p>

<p>Puisqu’il s’agit d’un broadcast, tous les ordinateurs du segment vont recevoir la requête. En observant son contenu, ils pourront déterminer quelle est l’adresse IP sur laquelle porte la recherche. La machine qui possède cette adresse IP sera la seule à répondre en envoyant à la machine émettrice une réponse ARP du type <em>« je suis adresseIP, mon adresse MAC est adresseMAC »</em>. Pour émettre cette réponse au bon ordinateur, il crée une entrée dans son cache ARP à partir des données contenues dans la requête ARP qu’il vient de recevoir.</p>

<p>La machine à l’origine de la requête ARP reçoit la réponse, met à jour son cache ARP et peut donc envoyer à l’ordinateur concerné le message qu’elle avait mis en attente.</p>

<h2 id="toc_5">Les masques</h2>

<div><pre><code class="language-none">192.168.1.0/23</code></pre></div>

<p>Le <code>/23</code> s&#39;appelle <strong>un masque</strong>, et designe le nombre de bits réservés dans l&#39;adresse IP. Il peeut également se traduire comme un filtre à 23 bits à 1 sous le format <code>255.255.254.0</code></p>

<p><code>32 - 23 = 9</code>, et <code>2^9 = 512</code>. On a donc <strong>512 IPs disponibles dans notre réseau</strong>. Par principe, nous n&#39;utilisons jamais la première et la dernière adresse. Cela signifie donc qu&#39;on peut avoir potentiellement jusqu&#39;à <strong>510 machines connectées à ce réseau</strong>.</p>

<blockquote>
<p>Il faut bien noter que, même si les réseaux en <code>/24</code> sont les plus répandus, il n&#39;est pas rare, notamment dans le monde professionnel, de trouver des réseaux avec des masques différents.</p>
</blockquote>

<p>On va se pencher sur les masques lorsqu&#39;on s&#39;intéresse à des usages spécifiques.   </p>

<p><strong><em>Exemple</em></strong> : Un gestionnaire des magasins McDonalds s&#39;occupe des restaurants ouverts sur le 12ème arrondissement de Paris. Il ouvre un nouveau magasin, ce qui monte le nombre total de magasins à 5. Il souhaite utiliser l&#39;adresse <code>192.168.12.0</code> comme adresse dédiée aux magasins du 12ème arrondissement.</p>

<p>Cependant, les restaurants ont, au plus, une dizaine de machines. Hors, cette adresse <code>192.168.12.0</code> peut contenir 256 adresses IPs, ce qui est disproportionné par rapport au besoin de chaque restaurant. On va donc diviser cette adresse en utilisant un masque afin de donner à chaque magasin un nombre d&#39;adresses IPs plus cohérent.</p>

<p><strong>Attention</strong> : Si on a deux réseaux qui se suivent en <code>/24</code>, on ne peut pas forcement les associer en <code>/23</code>. Par exemple, si on a <code>192.168.1.0/24</code> et <code>192.168.2.0/24</code>, on ne peux pas en faire un <code>192.168.1.0/23</code>. <strong>Il faut que le premier réseau commence par un nombre pair</strong>.</p>

<p><em>Le premier réseau a une adresse &quot;paire&quot;</em> :</p>

<table>
<thead>
<tr>
<th>192</th>
<th style="text-align: center">168</th>
<th style="text-align: center">0</th>
<th style="text-align: center">0</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>11000000</strong></td>
<td style="text-align: center"><strong>10101000</strong></td>
<td style="text-align: center"><strong>0000000</strong>0</td>
<td style="text-align: center">00000000</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>192</th>
<th style="text-align: center">168</th>
<th style="text-align: center">1</th>
<th style="text-align: center">0</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>11000000</strong></td>
<td style="text-align: center"><strong>10101000</strong></td>
<td style="text-align: center"><strong>0000000</strong>1</td>
<td style="text-align: center">00000000</td>
</tr>
</tbody>
</table>

<p>La partie commune est de <em>23 bits</em>, on peut donc l&#39;associer en <code>/23</code>.</p>

<p><em>Le premier réseau a une adresse &quot;impaire&quot;</em>  :</p>

<table>
<thead>
<tr>
<th>192</th>
<th style="text-align: center">168</th>
<th style="text-align: center">1</th>
<th style="text-align: center">0</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>11000000</strong></td>
<td style="text-align: center"><strong>10101000</strong></td>
<td style="text-align: center"><strong>000000</strong>01</td>
<td style="text-align: center">00000000</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>192</th>
<th style="text-align: center">168</th>
<th style="text-align: center">2</th>
<th style="text-align: center">0</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>11000000</strong></td>
<td style="text-align: center"><strong>10101000</strong></td>
<td style="text-align: center"><strong>000000</strong>10</td>
<td style="text-align: center">00000000</td>
</tr>
</tbody>
</table>

<p>La partie commune est de <em>22 bits</em>, on peut donc l&#39;associer en <code>/22</code> mais pas en <code>/23</code>.</p>

<p><strong>Exercice</strong> : La région Bretagne (Ile et Vilaine - 35) est associée à l&#39;adresse <code>172.35.0.0/22</code>. Déterminer les plages nécessaire pour les sites suivants :</p>

<ol>
<li>site 14 hosts</li>
<li>site 25 hosts</li>
<li>site 14 hosts</li>
</ol>

<p><em>Correction</em> :</p>

<div><pre><code class="language-none">1. 172.35.0.0/28 -&gt; 172.35.0.15
2. 172.35.0.32/27 -&gt; 172.35.0.63 (on part de .32 car le sous-réseau .16 est impair)
3. 172.35.0.64/28 -&gt; 172.35.0.79</code></pre></div>

<p><strong>VLSM</strong> : Variable Length Sub Mask</p>

<p><strong>Exercice</strong> : Prenons l&#39;adresse <code>129.213.0.0/20</code>. Créez les 4 sites suivants :</p>

<ol>
<li>20 IPs</li>
<li>64 IPs</li>
<li>128 IPs</li>
<li>64 IPs</li>
</ol>

<p><em>Correction</em> : </p>

<div><pre><code class="language-none">1. 129.213.0.0   /27
2. 129.213.0.64  /26
3. 129.213.0.128 /25
4. 129.213.1.0   /26</code></pre></div>

<h2 id="toc_6">Les vLANs</h2>

<p>L&#39;utilisation des materiels impliqués dans la mise en place des réseaux n&#39;était pas satisfaisante pour l&#39;amélioration des performances réseau. En moyenne, un serveur n&#39;est utilisé qu&#39;aux alentours de 10% de son temps d&#39;allumage. Cela entrainait des pertes sèches en terme de consommation, de refroidissement et d&#39;entretien. C&#39;est pour répondre à cette problématique qu&#39;ont été introduits les <em>Virtuals LANs</em> (ou vLAN).</p>

<p>Le principe est simple : on divise un gros switch matériel en plusieurs petits switchs virtuels.</p>

<h3 id="toc_7">Quelques définitions :</h3>

<ul>
<li><strong>EtherChannel</strong> : plusieurs liens physiques pour un lien logique.</li>
<li><strong>Spanning Tree</strong> (STP) : topologie basée sur la gestion du réseau par arbre recouvrant (inventé par Radia Perlman)</li>
<li><strong>Maximum Transfer Unit</strong> (MTU) : taille maximale des trames ethernet.</li>
</ul>

<p>Avec un vLAN, on peut s&#39;affranchir de certains problèmes inhérents aux LANs classiques :</p>

<ul>
<li>La flexibilité du réseau : plus de contraintes de distances physique entre les différents clients du réseau.</li>
</ul>

<p><strong>Spanning Tree :</strong> Un algorithme inventé par Radia Perlman au MIT visant à obtenir une topologie réseau permettant entre autre d&#39;éviter les boucles réseau.
Il existe plusieurs versions :</p>

<ul>
<li>STP-C : spanning tree classique</li>
<li>PV-STP : spanning tree pour chaque vLAN</li>
</ul>

<p><strong>Bridge ID :</strong> composé de deux valeurs qui vont subir des comparaisons</p>

<ul>
<li> Priorité (valeur par défaut 32768). </li>
<li> Adresse MAC.</li>
</ul>

<p>Pour déterminer la priorité entre deux switchs, on regarde d&#39;abord leurs priorités. Si on ne peux pas les départager, on utilise l&#39;adresse MAC. Les materiels les plus récents ont une adresse MAC plus grande que les anciens, donc ils perdent forcement les élections face à des matériels plus anciens. C&#39;est pour ça que des commandes existent et permettent à un administrateur réseau de sélectionner lui-même les bridges dans sa topologie.</p>

<p>Pour de la redondance de lien, on peut rassembler plusieurs chemins dans un seul port virtuel (<em>port channel</em>).</p>

<h4 id="toc_8">Etherchannel</h4>

<p>Protocoles de negociation : </p>

<ul>
<li>LACP (standardisé ISO)

<ul>
<li><em>ACTIVE</em></li>
<li><em>PASSIVE</em></li>
</ul></li>
<li>PAGP 

<ul>
<li><em>DESIRABLE</em></li>
<li><em>AUTO</em></li>
</ul></li>
</ul>

<h2 id="toc_9">Configurer un switch</h2>

<p>Pour configurer un switch, il faut entrer dans le mode de configuration du switch. Pour ce faire, on entre dans le terminal du switch, et on tape les commandes suivante :</p>

<div><pre><code class="language-none">en
conf t</code></pre></div>

<blockquote>
<p>Pour entrer dans le terminal d&#39;un switch dans Packet Tracer, il faut se rendre dans l&#39;onglet <em>CLI</em> de la fenêtre de configuration du switch. </p>
</blockquote>

<p>On est en mode config, on peut désormais implémenter les interfaces.</p>

<blockquote>
<p>Dans la plupart des extraits de commandes présentés dans la suite, il sera nécessaire d&#39;entrer en mode config avant de pouvoir les exécuter.</p>
</blockquote>

<p><em>Quelques astuces de commandes :</em></p>

<p>Vous rencontrerez un certain nombre de commandes dans la suite des notes, qui peuvent être facilement raccourcies. Voici quelques-uns des plus communs, mais n&#39;hésitez pas à en chercher d&#39;autres.</p>

<div><pre><code class="language-none">enable      | en
interface   | int
show        | sh</code></pre></div>

<h3 id="toc_10">Implémenter une interface</h3>

<p>Principe : </p>

<ol>
<li>On sélectionne des ports à regrouper.</li>
<li>On crée un channel-group.</li>
<li>On passe le port-channel de ce channel-group en mode <code>trunk</code>.</li>
</ol>

<blockquote>
<p>En règle générale, on implémente une interface sur deux switchs, aux extermités de liaisons multiples. Ainsi, si il existe 2 connexions entre un switch A et B, il faudra implémenter deux interfaces : une sur le switch A et une sur le switch B.</p>
</blockquote>

<p>En commandes, cela donne :</p>

<p>1 - On sélectionne le(s) port(s) avec une des trois options suivantes :</p>

<div><pre><code class="language-none">interface range f0/1    // On sélectionne le port 1.
interface range f0/1-4  // On sélectionne les ports 1 à 4 (1, 2, 3 et 4).
interface range f0/1,4  // On sélectionne les ports 1 et 4.</code></pre></div>

<p>2 - On crée un channel-group avec son <code>ID</code> et son <code>MODE</code>, qui dépend du protocole qu&#39;on souhaite utiliser (LACP, PAGP ou aucun) :</p>

<div><pre><code class="language-none">channel-group ID mode MODE</code></pre></div>

<p>3 - On sélectionne le port-channel du channel-group qu&#39;on vient de créer :</p>

<div><pre><code class="language-none">interface port-channel ID</code></pre></div>

<p>4 - On passe ce port-channel en mode <code>trunk</code> :</p>

<div><pre><code class="language-none">switchport mode trunk</code></pre></div>

<p>Et votre interface est désormais bien implémentée.</p>

<h4 id="toc_11">- Implémenter une interface LACP</h4>

<div><pre><code class="language-none">interface range f0/1-2
channel-group 1 mode active
exit
interface port-channel 1
switchport mode trunk </code></pre></div>

<h4 id="toc_12">- Implémenter une interface PAGP</h4>

<div><pre><code class="language-none">interface range f0/1-2
channel-group 1 mode desirable
exit
interface port-channel 1
switchport mode trunk </code></pre></div>

<h4 id="toc_13">- Implémenter une interface ON</h4>

<div><pre><code class="language-none">interface range f0/1-2
channel-group 1 mode on
exit
interface port-channel 1
switchport mode trunk </code></pre></div>

<h3 id="toc_14">Exercice</h3>

<p>Soit le réseau ci-dessous :</p>

<p><img src="exo1-1.png" alt="alt text"></p>

<h4 id="toc_15">Question</h4>

<p>Comment peut-on éviter les liens coupés (en orange) ?</p>

<h4 id="toc_16">Correction</h4>

<p>L&#39;objectif est de créer des port-channels pour gérer les différents liens. <em>En partant du principe que le réseau est configuré comme montré sur le schéma ci-dessus</em> : </p>

<p>Sur le <code>Switch0</code> :</p>

<div><pre><code class="language-none">int range f0/1-2
channel-group 1 mode active
exit
int port-channel 1
switchport mode trunk</code></pre></div>

<div><pre><code class="language-none">int range f0/7-8
channel-group 2 mode active
exit
int port-channel 2
switchport mode trunk</code></pre></div>

<p>Sur le <code>Switch1</code> :</p>

<div><pre><code class="language-none">int range f0/1-2
channel-group 1 mode active
exit
int port-channel 1
switchport mode trunk</code></pre></div>

<div><pre><code class="language-none">int range f0/3-4
channel-group 2 mode active
exit
int port-channel 2
switchport mode trunk</code></pre></div>

<p>Sur le <code>Switch2</code> :</p>

<div><pre><code class="language-none">int range f0/3-4
channel-group 1 mode active
exit
int port-channel 1
switchport mode trunk</code></pre></div>

<div><pre><code class="language-none">int range f0/5-6
channel-group 2 mode active
exit
int port-channel 2
switchport mode trunk</code></pre></div>

<p>Sur le <code>Switch3</code> :</p>

<div><pre><code class="language-none">int range f0/5-6
channel-group 1 mode active
exit
int port-channel 1
switchport mode trunk</code></pre></div>

<div><pre><code class="language-none">int range f0/7-8
channel-group 2 mode active
exit
int port-channel 2
switchport mode trunk</code></pre></div>

<p>On a regroupé les liens dupliqués dans des port-channels, les liens ne sont donc plus coupés. Si vous avez réussi, toutes les connexions devraient passer au vert.</p>

<h3 id="toc_17">VTP</h3>

<p>Le VTP (Vlan Trunking Protocol) permet de gérer la configuration des VLAN automatiquement. Ce protocole permet de transmettre automatiquement, via les ports trunk, la configuration des vlans.</p>

<p>Il existe 3 modes de switch :</p>

<ul>
<li><em>Mode serveur</em> : mode par défaut, permet de créer, modifier ou supprimer des vlans et synchronise cette configuration</li>
<li><em>Mode client</em> : ne permet pas de créer, modifier ou supprimer des vlans, mais permet la synchronisation de la configuration.</li>
<li><em>Mode transparent</em> : permet de créer, modifier ou supprimer des vlans, mais ne permet pas la synchronisation de la configuration.</li>
</ul>

<p>Ainsi, un switch en mode serveur va transmettre sa configuration aux switchs clients, qui connaitront les différents vlan créés par le serveur. Les switchs en mode transparent n&#39;appliquent pas ces configurations.</p>

<h4 id="toc_18">Remarque sur l&#39;ajout d&#39;anciens switchs</h4>

<p>Si on veut intégrer des anciens switchs dans son réseau, on peut se dire qu&#39;il suffit de réinitialiser la configuration et de l&#39;intégrer au réseau en l&#39;ajoutant au domaine VTP. Mais un gros problème peut survenir.</p>

<p>Si le switch a, au cours de sa vie, participé à beaucoup de VLAN, sa base de donnée de VLAN peut être ancienne, et avoir un numéro de version plus grand que les autres switchs du domaine. Par conséquent, les autres switchs du domaine vont remplacer leurs base de VLAN par celle de cet ancien switch.</p>

<p>Pour éviter ce problème, il faut <strong>réinitialiser la config du VLAN ET supprimer sa base de VLAN</strong>.</p>

<h4 id="toc_19">Assigner un port à un VLAN</h4>

<p>Pour assigner un port (ici pour l&#39;exemple le port 5) à un VLAN (ici pour l&#39;exemple le VLAN 3), sur le switch : </p>

<div><pre><code class="language-none">int f0/5
switchport mode access
switchport access vlan 3</code></pre></div>

<p>La machine branchée sur le port 5 du switch appartiendra donc au VLAN 3.</p>

<h2 id="toc_20">Configurer un routeur</h2>

<p>Maintenant qu&#39;on maitrise les switchs et les VLANs, ont veut que des machines puissent communiquer avec d&#39;autres machines qui sont dans des VLANs différents.</p>

<p>On va donc ajouter à notre réseau un routeur, qui sera connecté au switch bridge.</p>

<p>Vu que des paquets venant de différents VLANs vont circuler vers le routeur, il faut que la liaison soit en mode <code>trunk</code>. Pour ce faire, on utilise la séquence habituelle côté switch, et on va créer une sous-interface par VLAN sur le routeur comme ceci : </p>

<div><pre><code class="language-none">int f0/0
no ip address
no shutdown
int f0/0.2
encapsulation dot1Q X                      // avec X le numéro du VLAN
ip address 192.168.2.254 255.255.255.0     // ip terminée par 254 et le masque</code></pre></div>

<p>Pour communiquer entre les VLANs, il faut préciser sur toutes les machines la gateway. La gateway est l&#39;adresse IP de la sous-interface appartenant au VLAN de la machine. </p>

<blockquote>
<p>Dans Packet Tracer, on peut modifier la gateway dans l&#39;onglet <em>Config</em> d&#39;une machine.</p>
</blockquote>

<p>Par exemple, pour une machine <code>PC-1</code> dans un <code>vlan 3</code>, si l&#39;adresse de la sous-interface du <code>vlan 3</code> dans le routeur est <code>192.168.3.254</code>, la gateway de <code>PC-1</code> sera cette adresse. </p>

<h3 id="toc_21">Implémenter un serveur DHCP sur le routeur</h3>

<div><pre><code class="language-none">conf t
ip dhcp protocol CQTV1
network 192.168.X.0 255.255.255.0       // avec X le numéro du VLAN
default-router 192.168.X.254            // avec X le numéro du VLAN
domain-name 8.8.8.8</code></pre></div>




</body>

</html>
